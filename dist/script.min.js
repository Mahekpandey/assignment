document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("canvas"),t=document.querySelectorAll(".element"),a=document.getElementById("properties-form"),n=document.getElementById("delete-element");let o=null;function l(e){e.dataTransfer.setData("text/plain",e.target.dataset.type)}function r(e){if("INPUT"!==e.target.tagName){const t=prompt("Enter new text:",e.target.textContent);null!==t&&(e.target.tagName,e.target.textContent=t)}}function s(e){return e.startsWith("#")?e:"#"+c((e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))[1])+c(e[2])+c(e[3])}function c(e){const t=parseInt(e).toString(16);return 1===t.length?"0"+t:t}t.forEach((e=>{e.addEventListener("dragstart",l)})),e.addEventListener("dragover",(function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"})),e.addEventListener("drop",(function(t){t.preventDefault();const a=function(e){const t=document.createElement("div");switch(t.className="canvas-element",t.dataset.type=e,t.draggable=!0,e){case"text":t.textContent="Double click to edit text",t.style.minWidth="100px";break;case"heading":t.innerHTML="<h2>Heading</h2>",t.style.minWidth="200px";break;case"image":t.innerHTML='<img src="https://via.placeholder.com/150" style="max-width: 100%;">',t.style.minWidth="150px";break;case"button":t.innerHTML='<button style="padding: 10px 20px;">Button</button>',t.style.minWidth="100px"}return t}(t.dataTransfer.getData("text/plain")),n=e.getBoundingClientRect(),l=t.clientX-n.left,c=t.clientY-n.top;a.style.position="absolute",a.style.left=`${l}px`,a.style.top=`${c}px`,e.appendChild(a),function(e){let t,a,n,l,c=!1,d=0,i=0;function u(t){n=t.clientX-d,l=t.clientY-i,t.target===e&&(c=!0),document.addEventListener("mousemove",g),document.addEventListener("mouseup",m)}function g(o){c&&(o.preventDefault(),t=o.clientX-n,a=o.clientY-l,d=t,i=a,p(t,a,e))}function m(){n=t,l=a,c=!1,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",m)}function p(e,t,a){a.style.transform=`translate(${e}px, ${t}px)`}e.addEventListener("mousedown",u),e.addEventListener("dblclick",r),e.addEventListener("click",(t=>{t.stopPropagation(),function(e){o&&o.classList.remove("selected");o=e,e.classList.add("selected"),function(e){const t=document.getElementById("properties-form");document.querySelector(".no-selection").style.display="none",t.style.display="block";const a=e.dataset.type;if(t.querySelectorAll(".property-group").forEach((e=>{const t=e.dataset.for.split(",");t.includes(a)||t.includes("all")?e.style.display="block":e.style.display="none"})),"image"===a){const t=e.querySelector("img");document.getElementById("image-url").value=t.src}else document.getElementById("text-content").value=e.textContent;document.getElementById("font-size").value=parseInt(getComputedStyle(e).fontSize),document.getElementById("text-color").value=s(getComputedStyle(e).color),document.getElementById("bg-color").value=s(getComputedStyle(e).backgroundColor),document.getElementById("padding").value=parseInt(getComputedStyle(e).padding)}(e)}(e)}))}(a);const d=e.querySelector(".empty-message");d&&(d.style.display="none")})),e.addEventListener("click",(function(t){t.target===e&&o&&(o.classList.remove("selected"),o=null,a.style.display="none",document.querySelector(".no-selection").style.display="block")})),a.addEventListener("change",(function(e){if(!o)return;const t=o.dataset.type,a="button"===t&&o.querySelector("button")||o;switch(e.target.id){case"width":a.style.width=`${e.target.value}px`;break;case"height":a.style.height=`${e.target.value}px`;break;case"padding-top":case"padding-right":case"padding-bottom":case"padding-left":const n=e.target.id.split("-")[1];a.style[`padding${n.charAt(0).toUpperCase()+n.slice(1)}`]=`${e.target.value}px`;break;case"text-content":"button"===t?a.textContent=e.target.value:"heading"===t?a.querySelector("h2").textContent=e.target.value:a.textContent=e.target.value;break;case"font-family":case"font-size":case"font-weight":case"text-transform":case"letter-spacing":case"line-height":case"text-align":a.style[e.target.id]=e.target.id.includes("size")?`${e.target.value}px`:e.target.value;break;case"text-color":a.style.color=e.target.value;break;case"bg-color":a.style.backgroundColor=e.target.value;break;case"opacity":a.style.opacity=e.target.value;break;case"border-radius":a.style.borderRadius=`${e.target.value}px`;break;case"border-width":a.style.borderWidth=`${e.target.value}px`;break;case"border-style":a.style.borderStyle=e.target.value;break;case"border-color":a.style.borderColor=e.target.value;break;case"shadow-x":case"shadow-y":case"shadow-blur":case"shadow-spread":case"shadow-color":!function(e){const t=document.getElementById("shadow-x").value||0,a=document.getElementById("shadow-y").value||0,n=document.getElementById("shadow-blur").value||0,o=document.getElementById("shadow-spread").value||0,l=document.getElementById("shadow-color").value||"#000000";e.style.boxShadow=`${t}px ${a}px ${n}px ${o}px ${l}`}(a);break;case"image-url":if("image"===t){const t=a.querySelector("img");t&&(t.src=e.target.value,t.onerror=()=>{alert("Failed to load image. Please check the URL."),t.src="https://via.placeholder.com/150"})}break;case"object-fit":if("image"===t){const t=a.querySelector("img");t&&(t.style.objectFit=e.target.value)}}})),n.addEventListener("click",(function(){o&&(o.remove(),o=null,a.style.display="none",document.querySelector(".no-selection").style.display="block",e.querySelector(".canvas-element")||(e.querySelector(".empty-message").style.display="block"))}))}));